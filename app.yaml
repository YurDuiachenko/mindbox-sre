# –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, HR –∏ SRE –∫–æ–º–∞–Ω–¥—ã Mindbox!
# –ú–µ–Ω—è –∑–æ–≤—É—Ç –î—å—è—á–µ–Ω–∫–æ –Æ—Ä–∏–π, –∏ —ç—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –≤–∞–∫–∞–Ω—Å–∏—é DevOps-–∏–Ω–∂–µ–Ω–µ—Ä/SRE.

# –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —è —É–∂–µ —Ä–µ—à–∞–ª —ç—Ç–æ –∑–∞–¥–∞–Ω–∏–µ –≤ —Ä–∞–º–∫–∞—Ö –æ—Ç–±–æ—Ä–∞ –Ω–∞ –≤–∞—à—É SRE —Å—Ç–∞–∂–∏—Ä–æ–≤–∫—É (–∏ –±—ã–ª –∑–∞–Ω—è–ª –≤—Ç–æ—Ä–æ–µ –≤ –æ—Ç–±–æ—Ä–µüò≠).
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ —è —Å–ø—Ä–∞–≤–∏–ª—Å—è –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ –º–æ–∂–Ω–æ –Ω–∞ github: https://github.com/YurDuiachenko/mindbox-sre-intern/blob/main/app.yaml
# –ê —ç—Ç–æ—Ç —Ñ–∞–π–ª - —ç—Ç–æ —Ç–æ, –∫–∞–∫ —è –≤–∏–∂—É —Ä–µ—à–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–µ–π—á–∞—Å. 
# –û–Ω –æ—Ç—á–∞—Å—Ç–∏ –±—É–¥–µ—Ç —Ä–∞–∑–±–æ—Ä–æ–º –æ—à–∏–±–æ–∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ –æ—Ç–≤–µ—Ç–∞.

# –†–µ–±—è—Ç, —Ö–æ—á—É –ø–æ–∫–∞–∑–∞—Ç—å, –∫–∞–∫ –≤—ã—Ä–æ—Å, –∏, –¥–∞–∂–µ –µ—Å–ª–∏ –≤ –∏—Ç–æ–≥–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –Ω–µ –ø–æ–ª—É—á–∏—Ç—Å—è –ø–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å –≤–∞–º–∏ - 
# –±–ª–∞–≥–æ–¥–∞—Ä—é –∑–∞ –∫–ª–∞—Å—Å–Ω–æ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–æ—è–≤–∏—Ç—å —Å–µ–±—è!


# –ü–µ—Ä–≤—ã–π –º–æ–º–µ–Ω—Ç –∫–æ—Ç–æ—Ä—ã–π —è —É–ø—É—Å—Ç–∏–ª –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ –¥–æ–≤–æ–ª—å–Ω–æ –æ—á–µ–≤–∏–¥–µ–Ω: –Ω–∞—à–µ–º—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é –Ω—É–∂–µ–Ω –Ω–µ–π–º—Å–ø–µ–π—Å.
# –ï—Å–ª–∏ –º—ã –∫–æ–Ω–µ—á–Ω–æ –Ω–µ —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã –æ–Ω–æ –Ω–∞—Ö–æ–¥–∏–ª–æ—Å—å –≤ default (–∞ –º—ã –Ω–µ —Ö–æ—Ç–∏–º).
# –í —Ü–µ–ª–æ–º –ª—É—á—à–µ –Ω–∞–∑–≤–∞—Ç—å –µ–≥–æ –∫–∞–∫ —Å—Ç–µ–Ω–¥, –Ω–∞–ø—Ä–∏–º–µ—Ä dev –∏–ª–∏ qa, 
# –Ω–æ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è –±–æ–ª–µ–µ –ø–æ–¥—Ö–æ–¥—è—â–∏–º –¥–µ—Ä–∂–∞—Ç—å –≤—Å—ë –≤ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–æ–º –≤–∏–¥–µ, –ø–æ—ç—Ç–æ–º—É app-namespace.
apiVersion: v1
kind: Namespace
metadata:
  name: app-namespace

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-deployment
  namespace: app-namespace
  labels:
    app: app
spec:
  # –ù–∞ —Å—á—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ä–µ–ø–ª–∏–∫. 
  # –î–∞, –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫–∞–∑–∞–ª–æ, —á—Ç–æ 4 –ø–æ–¥–∞ —Å–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π, 
  # –Ω–æ 5 –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ—à–µ–Ω–∏–µ–º –ø–æ —Å–ª–µ–¥—É—é—â–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
  #   1. —ç—Ç–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ç–æ –µ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ –±–æ–ª—å—à–µ, –≤ —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ –ª—É—á—à–µ –∏–º–µ—Ç—å –∑–∞–ø–∞—Å;
  #   2. —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –ø—è—Ç—å –Ω–æ–¥, –≤ —Ü–µ–ª—è—Ö –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ —Ü–µ–ª–µ—Å–æ–æ–±—Ä–∞–∑–Ω–æ –±—ã–ª–æ –±—ã —Ä–∞–∑–Ω–µ—Å—Ç–∏ –ø–æ –ø–æ–¥—É –Ω–∞ –∫–∞–∂–¥—É—é –Ω–æ–¥—É, 
  #   –≤–µ–¥—å, –µ—Å–ª–∏ —É–ø–∞–¥—ë—Ç –æ–¥–Ω–∞ –Ω–æ–¥–∞ –ø—Ä–∏ 5 —Ä–µ–ø–ª–∏–∫–∞—Ö, —ç—Ç–æ –Ω–µ –ø–æ–≤–ª–∏—è–µ—Ç –Ω–∞ –æ–±—â—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, 
  #   –∞ –µ—Å–ª–∏ —É –Ω–∞—Å –ø–∏–∫, –∏ —Ä–µ–ø–ª–∏–∫ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ 4, –∏ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç —É–∑–µ–ª?
  # 
  # –¢–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ –±—ã–ª–∞ —É –º–µ–Ω—è –≤ –ø–µ—Ä–≤–æ–º –æ—Ç–≤–µ—Ç–µ, —è —Å –Ω–µ–π –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω. –ö–∞–∫ –±—ã —è –Ω–µ —Å—Ç–∞—Ä–∞–ª—Å—è –ø—Ä–∏—Ç—è–Ω—É—Ç—å –∑–∞ —É—à–∏ 5 –ø–æ–¥–æ–≤,
  # –≤ –∫–æ–Ω—Ü–µ –∫–æ–Ω—Ü–æ–≤ —è –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–Ω—è–ª, —á—Ç–æ 4 –ª—É—á—à–µ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
  #   1. –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω—É–∂–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫, –∏ –µ—Å–ª–∏ –∏–∑–≤–µ—Å—Ç–Ω–æ, —á—Ç–æ 4 –ø–æ–¥–∞ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø–∏–∫, —Ç–æ –µ—â—ë –æ–¥–∏–Ω –ø–æ–¥
  #   —ç—Ç–æ –ø—É—Å—Ç–∞—è —Ç—Ä–∞—Ç–∞ —Ä–µ—Å—É—Ä—Å–æ–≤. –≠—Ç–æ—Ç –ø–æ–¥ –ø—Ä–∏ –∫—Ä–∞–π–Ω–µ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏ —Ç–∞–∫ –±—É–¥–µ—Ç –ø–æ–¥–Ω—è—Ç.
  #   2. 4 –ø–æ–¥–∞ –ø—Ä–µ–∫—Ä–∞—Å–Ω–æ —Ä–∞–∑–Ω–µ—Å—É—Ç—Å—è –Ω–∞ 5 –Ω–æ–¥, –µ—â—ë –∏ –º–µ—Å—Ç–æ —Å–≤–æ–±–æ–¥–Ω–æ–µ –æ—Å—Ç–∞–≤—è—Ç –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π. –¢–∞–∫–æ–π –≤–∞—Ä–∏–∞–Ω—Ç —ç–∫–æ–Ω–æ–º–∏—á–Ω–µ–µ.
  replicas: 4
  # –ù–∞ —Å–∞–º–æ–º –¥–µ–ª–µ —Ç–∞–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ–ª—É—á–∞—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –Ω–æ –º–Ω–µ –∫–∞–∂–µ—Ç—Å—è –ª—É—á—à–µ –¥–µ—Ä–∂–∞—Ç—å –∏—Ö –≤ —è–≤–Ω–æ–º –≤–∏–¥–µ –∏ –Ω–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö.
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 1 
    maxUnavailable: 1
  selector:
    matchLabels:
      app: app
  template:
    metadata:
      labels:
        app: app
    spec:
      affinity:
        # –ü–æ–º–Ω–∏—Ç–µ –ø—Ä–æ –∏–¥–µ—é —Ä–∞–∑–Ω–µ—Å—Ç–∏ –ø–æ –ø–æ–¥—É –Ω–∞ –Ω–æ–¥—É? –í–æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è :)
        # –Ø –¥—É–º–∞—é –≤—Å—ë —Ç–∞–∫–∏ —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã–º, –Ω–µ–∂–µ–ª–∏ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º, 
        # –ø–æ—Ç–æ–º—É —á—Ç–æ –Ω–µ —Ö–æ—á–µ—Ç—Å—è —á—Ç–æ–±—ã –∫–∞–∫–∏–µ-—Ç–æ –ø–æ–¥—ã –≤–∏—Å–µ–ª–∏ –≤ Pending.
        # –û–Ω–∏ –≤—Å—ë —Ä–∞–≤–Ω–æ –±—É–¥—É—Ç —Ä–∞–∑–º–µ—â–µ–Ω—ã –Ω–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É–∑–ª–∞—Ö, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–Ω–∞ –∏–ª–∏ –¥–∞–∂–µ –¥–≤–µ –Ω–æ–¥—ã –±—É–¥—É—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã. 
        #
        # –¢—É—Ç —è —Å —Å–æ–±–æ–π –ø—Ä–æ—à–ª—ã–º —Å–æ–≥–ª–∞—Å–µ–Ω.
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 100
              podAffinityTerm:
                labelSelector:
                  matchExpressions:
                    - key: app
                      operator: In
                      values:
                        - app
                topologyKey: "kubernetes.io/hostname"
              # –ò –¥–æ–±–∞–≤–ª—é –µ—â—ë –Ω–µ—Å—Ç—Ä–æ–≥–æ–µ –ø—Ä–∞–≤–∏–ª–æ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –ø–æ –∑–æ–Ω–∞–º (–≤–µ–¥—å –∫–ª–∞—Å—Ç–µ—Ä —É –Ω–∞—Å –º—É–ª—å—Ç–∏–∑–æ–Ω–∞–ª—å–Ω—ã–π).
              # –≠—Ç–æ –ø–æ–≤—ã—Å–∏—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å.
            - weight: 100
              podAffinityTerm:
                labelSelector:
                  matchExpressions:
                    - key: app
                      operator: In
                      values:
                      - app
                topologyKey: "topology.kubernetes.io/zone"
      containers:
        - name: app
          # –†–∞–Ω—å—à–µ —Ç—É—Ç —Å—Ç–æ—è–ª–æ app:latest, —Ç–∞–∫ –ª—É—á—à–µ –Ω–µ –¥–µ–ª–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ –≤–µ–¥—ë—Ç –∫ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é.
          image: app:1.0.0
          # –î–∞–ª–µ–µ –ø—Ä–æ —Ä–µ—Å—É—Ä—Å—ã.
          # –í –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ —è –ø–æ—Å—Ç–∞–≤–∏–ª —Ä–µ–∫–≤–µ—Å—Ç—ã 0.1 CPU –∏ 128M, –∞ –ª–∏–º–∏—Ç—ã 1 CPU –∏ 256M. –≠—Ç–æ –±—ã–ª–æ –ø–ª–æ—Ö–æ–µ —Ä–µ—à–µ–Ω–∏–µ.
          #
          # –û–±–æ –≤—Å—ë–º –ø–æ –ø–æ—Ä—è–¥–∫—É, –Ω–∞—á–Ω—ë–º —Å CPU:
          # –í –ø–µ—Ä–≤–æ–º —Ä–µ—à–µ–Ω–∏–∏ —è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –∞–≤–æ—Å—å —Ç—ã–∫–Ω—É–ª –ø–∞–ª—å—Ü–µ–º –≤ –Ω–µ–±–æ, –ø–æ—Å—Ç–∞–≤–∏–≤ –ª–∏–º–∏—Ç 1.
          # –ó–∞—Ç–µ–º, –∫–æ–≥–¥–∞ –∑–∞–¥—É–º–∞–ª—Å—è –æ–± —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ hpa, –ø–æ–Ω—è–ª –≤–¥—Ä—É–≥, —á—Ç–æ –ª–∏–º–∏—Ç –º–Ω–µ
          # –≤ —ç—Ç–æ–º –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç, –∞ –Ω–∞–±–æ—Ä–æ—Ç - –º–µ—à–∞–µ—Ç, –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—è –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ. –ú—ã –Ω–µ –º–æ–∂–µ–º –∑–Ω–∞—Ç—å –ª–∏–º–∏—Ç. 
          # –ü–æ–¥–±–∏—Ä–∞—Ç—å –µ–≥–æ ‚Äî –Ω–µ–±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ–µ –¥–µ–ª–æ,
          # –æ—Å–æ–±–µ–Ω–Ω–æ –∫–æ–≥–¥–∞ –≤ –∑–∞–¥–∞–Ω–∏–∏ "–Ω–∞ –ø–µ—Ä–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –±–æ–ª—å—à–µ —Ä–µ—Å—É—Ä—Å–æ–≤ CPU", 
          # –∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –º–Ω–æ–≥–æ ‚Äî —ç—Ç–æ —Å–∫–æ–ª—å–∫–æ? –ú–æ–∂–Ω–æ –ø—Ä–æ–≥–∞–¥–∞—Ç—å.
          # –ü–æ–¥—É–º–∞–≤, —è –ø—Ä–∏—à—ë–ª –∫ –≤—ã–≤–æ–¥—É, —á—Ç–æ –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª–µ–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –±—É–¥–µ—Ç –æ—Ç–∫–∞–∑ –æ—Ç –ª–∏–º–∏—Ç–∞ –≤–æ–≤—Å–µ 
          # –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ CPU —á–µ—Ä–µ–∑ —Ä–µ–∫–≤–µ—Å—Ç –∏ HPA.
          # –ü–æ—è–≤–∏–ª–∞—Å—å –¥—Ä—É–≥–∞—è –ø—Ä–æ–±–ª–µ–º–∞ - –≤—ã—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∫–≤–µ—Å—Ç–∞: –Ω—É–∂–Ω–æ —Ç–∞–∫–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —Ä–µ–∫–≤–µ—Å—Ç–∞, 
          # –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —ç–∫–æ–Ω–æ–º–∏—á–Ω—ã–º –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É HPA, —Ç–æ –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥–æ–≤ –ø—Ä–∏ –Ω—É–∂–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ.
          # –ü–æ—Å–ª–µ –ø–æ–ø—ã—Ç–æ–∫ —Ä–µ—à–∏—Ç—å —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏, —è –ø–µ—Ä–µ—à—ë–ª –∫ –ø–æ–¥–±–æ—Ä—É –∏ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª—Å—è –Ω–∞ 0.2
          # 
          # –¢–µ–ø–µ—Ä—å –æ memory:
          # –° —Ä–µ–∫–≤–µ—Å—Ç–æ–º –ø–æ–Ω—è—Ç–Ω–æ, –æ–Ω –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —É–∫–∞–∑–∞–Ω –≤ –∑–∞–¥–∞–Ω–∏–∏ - 128Mi, –∞ –ª–∏–º–∏—Ç —è —Å–Ω–æ–≤–∞ –≤–∑—è–ª —Å —Ä–∞–∑–º–∞—Ö–æ–º - 256Mi,
          # –Ω–∞–ø–∏—Å–∞–≤, —á—Ç–æ —ç—Ç–æ —É–±–µ—Ä–µ–∂—ë—Ç –Ω–∞—Å –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏. –ù–æ —ç—Ç–æ —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ, –æ—Ç –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–µ —É–±–µ—Ä–µ–∂—ë—Ç, –∞ —Ä–µ—Å—É—Ä—Å–æ–≤ –ø–æ—Ç—Ä–∞—Ç–∏—Ç.
          # –Ø –±—É–∫–≤–∞–ª—å–Ω–æ –ø–æ–∑–≤–æ–ª–∏–ª —É–±–∏–≤–∞—Ç—å –ø–æ–¥, —Ä–∞—Å—Ö–æ–¥—É—é—â–∏–π –∞–Ω–æ–º–∞–ª—å–Ω–æ –º–Ω–æ–≥–æ, —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –æ–Ω –∏–∑—Ä–∞—Å—Ö–æ–¥—É–µ—Ç –≤ –¥–≤–∞ —Ä–∞–∑–∞ –±–æ–ª—å—à–µ.
          # –†–µ–∫–≤–µ—Å—Ç –∏ –ª–∏–º–∏—Ç –Ω–∞ –ø—è–º—è—Ç—å –Ω—É–∂–Ω–æ –¥–µ—Ä–∂–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–ª–∏–∂–µ –∫ –¥—Ä—É–≥ –¥—Ä—É–≥—É, –≤ –∏–¥–µ–∞–ª–µ - —Ä–∞–≤–Ω—ã–º–∏.
          # –í –∑–∞–¥–∞–Ω–∏–∏ "–≤—Å–µ–≥–¥–∞ ‚Äú—Ä–æ–≤–Ω–æ‚Äù –≤ —Ä–∞–π–æ–Ω–µ 128M memory". –Ø –±—ã –≤—Å—ë-—Ç–∞–∫–∏ —É—Ç–æ—á–Ω–∏–ª, –∞ —Å–∫–æ–ª—å–∫–æ —ç—Ç–æ - "–≤ —Ä–∞–π–æ–Ω–µ".
          # –ü–æ—Ç–æ–º—É —á—Ç–æ, –µ—Å–ª–∏ –≤ —Å—Ä–µ–¥–Ω–µ–º –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–µ –≤—ã—Ö–æ–¥–∏—Ç –∑–∞ 128, —Ç–æ–≥–¥–∞ —Ä–µ–∫–≤–µ—Å—Ç –∏ –ª–∏–º–∏—Ç –º–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ 128.
          # –ï—Å–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç, –Ω–æ –Ω–µ —Å–∏–ª—å–Ω–æ —Ç–æ –ø–æ–¥–æ–π–¥—ë—Ç 128 –∏ 150. –Ø –ø–æ—Å—Ç–∞–≤–ª—é —Ä–æ–≤–Ω–æ. 
          resources:
            requests:
              cpu: "0.2"
              memory: "128Mi"
            limits:
              memory: "128Mi"
          # –ü—Ä–∏–≥–æ–¥–∏—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–æ, –≥–æ—Ç–æ–≤–æ –ª–∏ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫.
          # –ó–Ω–∞—è, —á—Ç–æ –µ–º—É –¥–ª—è —Å—Ç–∞—Ä—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è 5-10 —Å–µ–∫—É–Ω–¥ —Å—Ç–∞–≤–∏–º –ø–µ—Ä–≤—É—é –ø—Ä–æ–±—É –Ω–∞ 10, –∞ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º –≤ 5.
          readinessProbe:
            httpGet:
              path: /healthz
              port: 80
            initialDelaySeconds: 10
            periodSeconds: 5
          # –í —Ü–µ–ª–æ–º –≤—Ä–µ–º—è –Ω–∞ –ª–∏–≤–∏–Ω–µ—Å—Å –ø—Ä–æ–±—É –±–æ–ª—å—à–µ, —á—Ç–æ –±—ã —Å–Ω–∞—á–∞–ª —É–±—Ä–∞—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –æ—Ç –ø–æ–¥–∞, –µ—Å–ª–∏ –æ–Ω –∑–∞–≤–∞–ª–∏—Ç —Ä–µ–¥–∏–Ω–µ—Å –ø—Ä–æ–±—É,
          # –∞ –ø–æ—Ç–æ–º –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ, –µ—Å–ª–∏ –æ–Ω –∑–∞–≤–∞–ª–∏—Ç –µ—â—ë –∏ –ª–∏–≤–∏–Ω–µ—Å—Å –ø—Ä–æ–±—É, –∏ –ø—Ä–æ–≤–µ—Å—Ç–∏ –ø—Ä–æ–±—ã –∑–∞–Ω–æ–≤–æ.
          livenessProbe:
            httpGet:
              path: /healthz
              port: 80
            initialDelaySeconds: 20
            periodSeconds: 20
          ports:
            - containerPort: 80

# –í –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ —É—Å–∏–ª–µ–Ω–Ω–æ–π —ç–∫–æ–Ω–æ–º–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤.
# –ù–æ—á—å—é –Ω–∞–º –≤—Å–µ –ø–æ–¥—ã –Ω–µ –Ω—É–∂–Ω—ã, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –∏—Ö –∫–æ–ª–∏—á–µ—Å–≤—Ç–≤–æ –¥–æ 3,
# –∞ –≤ –º–æ–º–µ–Ω—Ç—ã –ø–∏–∫–æ–≤ –Ω–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–Ω—è—Ç—å –¥–æ 5 –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
---
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: app-hpa
  namespace: app-namespace
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: my-app-deployment
  # –¢—É—Ç —Å–ø–æ—Ä–Ω–æ, –º–æ–∂–Ω–æ minReplicas –ø–æ—Å—Ç–∞–≤–∏—Ç—å –∏ –ø–æ–º–µ–Ω—å—à–µ, –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ –Ω–∞—Å–∫–æ–ª—å–∫–æ —Å–∏–ª—å–Ω–æ –ø–∞–¥–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫–∞.
  # –í –∑–∞–¥–∞–Ω–∏–∏ "–Ω–æ—á—å—é –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ –ø–æ—Ä—è–¥–∫–∏ –º–µ–Ω—å—à–µ", —Ç–æ –µ—Å—Ç—å –≤ —Ç–µ–æ—Ä–∏–∏ –º–æ–∂–Ω–æ 2 –∏–ª–∏ –¥–∞–∂–µ 1, —ç—Ç–æ –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç —Ä–µ—Å—É—Ä—Å—ã, 
  # –Ω–æ —è –ø–æ—Å—Ç–∞–≤–ª—é 3 –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π.
  minReplicas: 3
  maxReplicas: 5
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 80

# –ò—Å–ø–æ–ª—å–∑—É–µ–º Service ClusterIP —Å Ingress –≤–º–µ—Å—Ç–æ –ø—Ä–æ—Å—Ç–æ–≥–æ Service LoadBalancer, –∫–∞–∫ –≤ –ø—Ä–æ—à–ª–æ–º –≤–∞—Ä–∏–∞–Ω—Ç–µ.
# –ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ?
# - Service —Å–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏ –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É –Ω–µ –ø—Ä—è–º–æ–π, –∞ –æ–ø–æ—Å—Ä–µ–¥–æ–≤–∞–Ω–Ω—ã–π, —á—Ç–æ –ø–æ–≤—ã—à–∞–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æc—Ç—å
# - Ingress –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –º–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏
# - Ingress –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤
---
apiVersion: v1
kind: Service
metadata:
  name: app-service
  namespace: app-namespace
  labels:
    app: app
spec:
  type: ClusterIP
  selector:
    app: app
  ports:
    - protocol: TCP
      port: 80
      targetPort: 80

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: app-ingress
  namespace: app-namespace
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /
spec:
  rules:
  - host: app.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: app-service
            port:
              number: 80

# –ü–æ—á–µ–º—É –Ω–µ—Ç VPA –∏ PDB?
# –û–Ω–∏ –∫–∞–∂—É—Ç—Å—è –º–Ω–µ –∏–∑–±—ã—Ç–æ—á–Ω—ã–º–∏ –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –ø—Ä–∏—á–∏–Ω–∞–º:
# - –Ω–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ cpu –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è hpa, –∑–Ω–∞—á–∏—Ç –Ω–∞ vpa –æ—Å—Ç–∞—ë—Ç—Å—è –ø–∞–º—è—Ç—å (–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Ö –≤–º–µ—Å—Ç–µ –Ω–∞ –æ–¥–Ω–æ–º —Ä–µ—Å—É—Ä—Å–µ –≤–µ–¥—ë—Ç –∫ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é) 
# - –Ω–æ –ø–∞–º—è—Ç—å —Ç–æ —Ä–æ–≤–Ω–∞—è
# - pdb –Ω–∏—á–µ–º –Ω–µ –ø–æ–º–æ–∂–µ—Ç –ø—Ä–∏ –Ω–µ–∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–±–æ—è—Ö, –∞ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø–æ–¥–æ–≤ –ø—Ä–∏ –ø–ª–∞–Ω–æ–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —É–∫–∞–∑–∞–Ω–æ —è–≤–Ω–æ

# –°–ø–∞—Å–∏–±–æ –∑–∞ –ø—Ä–æ—á—Ç–µ–Ω–∏–µ!